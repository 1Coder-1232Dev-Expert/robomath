<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RoboMed â€” Ø±Ø¨Ø§Øª Ø±ÛŒØ§Ø¶ÛŒ Ù¾Ø§ÛŒÙ‡ Ù†Ù‡Ù…</title>
<link rel="preconnect" href="https://cdnjs.cloudflare.com">
<style>
  :root{
    --blue:#0d47a1; --light:#e9f3ff; --btn:#1565c0;
  }
  body{font-family: Vazir, Arial, sans-serif; background:linear-gradient(135deg,var(--light),#bbdefb); margin:0; padding:20px; color:#023047}
  .app{max-width:1100px;margin:10px auto}
  header{display:flex;align-items:center;justify-content:space-between}
  h1{margin:0;color:var(--blue)}
  .menu{margin-top:18px;display:flex;flex-wrap:wrap;gap:10px}
  .menu button{background:var(--btn);color:#fff;border:none;padding:10px 16px;border-radius:10px;cursor:pointer}
  .content{margin-top:20px;background:#fff;border-radius:12px;padding:18px;box-shadow:0 6px 20px rgba(0,0,0,0.08)}
  .hidden{display:none}
  .row{display:flex;gap:16px;flex-wrap:wrap}
  .col{flex:1;min-width:280px}
  input[type="text"], textarea, select{width:100%;padding:10px;border-radius:8px;border:1px solid #cfe0ff;font-size:15px}
  label{display:block;margin:8px 0 6px;font-weight:600}
  .btn{background:var(--btn);color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer}
  pre{background:#f3f7ff;border-radius:8px;padding:12px;overflow:auto}
  .example{font-size:13px;color:#666;margin-top:6px}
  footer{margin-top:18px;text-align:center;color:#555}
  /* lesson styles */
  .lesson h2{color:var(--blue);margin-bottom:6px}
  .lesson .figure{margin:12px 0;padding:10px;border-radius:8px;background:#f7fbff;border:1px solid #e1efff}
  .steps{background:#f1f9ff;border-radius:8px;padding:12px;margin-top:10px}
  .kbd{background:#eaf2ff;padding:4px 8px;border-radius:6px;font-family:monospace}
</style>
<!-- math.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
</head>
<body>
<div class="app">
  <header>
    <h1>ğŸ¤– RoboMed â€” Ø±Ø¨Ø§Øª Ø±ÛŒØ§Ø¶ÛŒ Ù¾Ø§ÛŒÙ‡ Ù†Ù‡Ù…</h1>
    <div style="text-align:left">
      <small>Ø±Ù†Ú¯â€ŒØ¨Ù†Ø¯ÛŒ: Ø¢Ø¨ÛŒ/Ø³ÙÛŒØ¯ â€¢ Ø·Ø±Ø§Ø­ÛŒ Ø§Ù¾â€ŒÙ†Ù…Ø§</small>
    </div>
  </header>

  <div class="menu" role="navigation" aria-label="ÙØµÙˆÙ„">
    <button onclick="show('ch1')">Û±ï¸âƒ£ Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§</button>
    <button onclick="show('ch2')">Û²ï¸âƒ£ Ø¹Ø¯Ø¯Ù‡Ø§ÛŒ Ø­Ù‚ÛŒÙ‚ÛŒ</button>
    <button onclick="show('ch3')">Û³ï¸âƒ£ Ø§Ø³ØªØ¯Ù„Ø§Ù„ Ùˆ Ø§Ø«Ø¨Ø§Øª</button>
    <button onclick="show('ch4')">Û´ï¸âƒ£ ØªÙˆØ§Ù† Ùˆ Ø±ÛŒØ´Ù‡</button>
    <button onclick="show('ch5')">Ûµï¸âƒ£ Ø¹Ø¨Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¨Ø±ÛŒ</button>
    <button onclick="show('ch6')">Û¶ï¸âƒ£ Ø®Ø· Ùˆ Ù…Ø¹Ø§Ø¯Ù„Ù‡ Ø®Ø·</button>
    <button onclick="show('ch7')">Û·ï¸âƒ£ Ø¹Ø¨Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ú¯ÙˆÛŒØ§</button>
    <button onclick="show('ch8')">Û¸ï¸âƒ£ Ø­Ø¬Ù… Ùˆ Ù…Ø³Ø§Ø­Øª</button>
  </div>

  <!-- content -->
  <div id="ch1" class="content hidden">
    <div class="lesson">
      <h2>ğŸ“˜ ÙØµÙ„ Û± â€” Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§ (Ù…Ø­Ø§Ø³Ø¨Ø§Øª)</h2>
      <div class="row">
        <div class="col">
          <label>Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ø¬Ù…ÙˆØ¹Ù‡ (A Ùˆ B Ø±Ø§ Ø¨Ø§ ÙØ§ØµÙ„Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯)</label>
          <input id="setA" placeholder="Ù…Ø«Ø§Ù„: 1 2 3">
          <input id="setB" placeholder="Ù…Ø«Ø§Ù„: 2 3 4">
          <label>Ø¹Ù…Ù„ÛŒØ§Øª</label>
          <select id="setOp">
            <option value="union">Ø§Ø¬ØªÙ…Ø§Ø¹ A âˆª B</option>
            <option value="inter">Ø§Ø´ØªØ±Ø§Ú© A âˆ© B</option>
            <option value="diff">ØªÙØ§Ø¶Ù„ A âˆ’ B</option>
          </select>
          <div style="margin-top:10px">
            <button class="btn" onclick="doSet()">Ù…Ø­Ø§Ø³Ø¨Ù‡</button>
          </div>
          <div id="setOut" style="margin-top:12px"></div>
        </div>

        <div class="col">
          <label>ØªØ¹Ø¯Ø§Ø¯ Ø²ÛŒØ±Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§ (n)</label>
          <input id="subN" placeholder="Ù…Ø«Ø§Ù„: 5" type="text">
          <div style="margin-top:10px">
            <button class="btn" onclick="doSubsets()">Ù…Ø­Ø§Ø³Ø¨Ù‡</button>
          </div>
          <div id="subOut" style="margin-top:12px"></div>

          <hr style="margin:12px 0">

          <label>Ù‚Ø§Ù†ÙˆÙ† Ø´Ù…ÙˆÙ„ Ùˆ Ø¹Ø¯Ù… Ø´Ù…ÙˆÙ„</label>
          <div class="example">ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯: A , B , ØªØ¹Ø¯Ø§Ø¯ Ù…Ø´ØªØ±Ú© (Ù…Ø«Ø§Ù„: 12, 8, 5)</div>
          <input id="incA" placeholder="A">
          <input id="incB" placeholder="B">
          <input id="incBoth" placeholder="A âˆ© B">
          <div style="margin-top:10px">
            <button class="btn" onclick="doInclusion()">Ù…Ø­Ø§Ø³Ø¨Ù‡</button>
          </div>
          <div id="incOut" style="margin-top:12px"></div>
        </div>
      </div>
    </div>
  </div>

  <div id="ch2" class="content hidden">
    <div class="lesson">
      <h2>ğŸ“— ÙØµÙ„ Û² â€” Ø¹Ø¯Ø¯Ù‡Ø§ÛŒ Ø­Ù‚ÛŒÙ‚ÛŒ (Ø¬Ø²ÙˆÙ‡)</h2>
      <p>Ø§Ø¹Ø¯Ø§Ø¯ Ø­Ù‚ÛŒÙ‚ÛŒ = Ø§Ø¹Ø¯Ø§Ø¯ Ú¯ÙˆÛŒØ§ âˆª Ø§Ø¹Ø¯Ø§Ø¯ Ú¯Ù†Ú¯. Ø±ÙˆÛŒ Ù…Ø­ÙˆØ± Ø§Ø¹Ø¯Ø§Ø¯ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.</p>
      <div class="figure">
        <strong>Ù‚Ø¯Ø± Ù…Ø·Ù„Ù‚ (ØªØ¹Ø±ÛŒÙ)</strong>
        <div>|x| = { x Ø§Ú¯Ø± x â‰¥ 0, âˆ’x Ø§Ú¯Ø± x &lt; 0 }</div>
        <div class="example">Ù…Ø«Ø§Ù„â€ŒÙ‡Ø§: |âˆ’5|=5 ØŒ |3/2|=1.5 ØŒ |âˆš9âˆ’4|=|3âˆ’4|=1</div>
      </div>
      <h3>Ù‚Ø§Ù†ÙˆÙ†ÛŒ Ú©Ù‡ Ù…Ø¹Ù„Ù… Ú¯ÙØª â€” Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø± Ù…Ø§Ø´ÛŒÙ†â€ŒØ­Ø³Ø§Ø¨</h3>
      <div>
        ÙˆÙ‚ØªÛŒ Ø¯Ø§Ø®Ù„ Ù‚Ø¯Ø± Ù…Ø·Ù„Ù‚ ØªØ±Ú©ÛŒØ¨ÛŒ Ø§Ø² Ø¹Ø¯Ø¯ Ùˆ Ø±Ø§Ø¯ÛŒÚ©Ø§Ù„ Ù‡Ø³Øª: Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø§Ø¨ØªØ¯Ø§ <span class="kbd">root(...)</span> Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø¹Ø¯Ø¯ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ Ø³Ù¾Ø³ Ù…Ù‚Ø¯Ø§Ø± Ú©Ù„ÛŒ Ø¹Ø¨Ø§Ø±Øª Ø±Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ Ù‚Ø¯Ø± Ù…Ø·Ù„Ù‚ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯. Ø§Ú¯Ø± Ø¯Ø± Ø­Ø§Ù„Øª Ù…Ù‚Ø§ÛŒØ³Ù‡Ù” Ø§Ù†Ø¯Ø§Ø²Ù‡ Ù„Ø§Ø²Ù… Ø¨Ø§Ø´Ø¯ (Ù…Ø«Ø§Ù„ Ø¢Ù…ÙˆØ²Ø´ÛŒ)ØŒ Ø±ÙˆØ§Ù„ Ù†Ù…ÙˆÙ†Ù‡â€ŒØ§ÛŒ Ú¯Ø§Ù…â€ŒØ¨Ù‡â€ŒÚ¯Ø§Ù… Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
      </div>
      <div class="figure" style="margin-top:12px">
        <img src="" alt="Ù…Ø­ÙˆØ± Ø§Ø¹Ø¯Ø§Ø¯" style="max-width:360px">
      </div>
    </div>
  </div>

  <div id="ch3" class="content hidden">
    <div class="lesson">
      <h2>ğŸ“˜ ÙØµÙ„ Û³ â€” Ø§Ø³ØªØ¯Ù„Ø§Ù„ Ùˆ Ø§Ø«Ø¨Ø§Øª Ø¯Ø± Ù‡Ù†Ø¯Ø³Ù‡ (Ø¬Ø²ÙˆÙ‡)</h2>
      <p>Ù‡Ù…â€ŒÙ†Ù‡Ø´ØªÛŒ Ù…Ø«Ù„Ø«â€ŒÙ‡Ø§: SSS, SAS, ASA, RHS. Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù‚Ø§Ø¹Ø¯Ù‡ Ù†Ù…ÙˆÙ†Ù‡ Ùˆ Ø´Ú©Ù„:</p>
      <div class="figure">
        <strong>SSS)</strong> Ø§Ú¯Ø± Ø³Ù‡ Ø¶Ù„Ø¹ Ø¯Ùˆ Ù…Ø«Ù„Ø« Ø¨Ø±Ø§Ø¨Ø± Ø¨Ø§Ø´Ø¯ â†’ Ù‡Ù…â€ŒÙ†Ù‡Ø´ØªÛŒ.
        <br><strong>SAS)</strong> Ø¯Ùˆ Ø¶Ù„Ø¹ Ùˆ Ø²Ø§ÙˆÛŒÙ‡ Ø¨ÛŒÙ†Ø´Ø§Ù† Ø¨Ø±Ø§Ø¨Ø± â†’ Ù‡Ù…â€ŒÙ†Ù‡Ø´ØªÛŒ.
      </div>
      <div class="figure" style="margin-top:12px">
        <!-- simple SVG example -->
        <svg width="320" height="140" viewBox="0 0 320 140" xmlns="http://www.w3.org/2000/svg">
          <polyline points="20,120 160,20 300,120" fill="none" stroke="#1565c0" stroke-width="3"/>
          <text x="150" y="30" font-size="12" text-anchor="middle" fill="#023047">Ù…Ø«Ù„Ø« ABC</text>
        </svg>
      </div>
    </div>
  </div>

  <div id="ch4" class="content hidden">
    <div class="lesson">
      <h2>ğŸ“˜ ÙØµÙ„ Û´ â€” ØªÙˆØ§Ù† Ùˆ Ø±ÛŒØ´Ù‡ (Ù…Ø­Ø§Ø³Ø¨Ù‡)</h2>
      <div class="row">
        <div class="col">
          <label>Ù‚Ø§Ù†ÙˆÙ†â€ŒÙ‡Ø§ÛŒ ØªÙˆØ§Ù† â€” ÙˆØ±ÙˆØ¯ÛŒ: Ù…Ø«Ø§Ù„ <span class="kbd">a^m / a^n</span></label>
          <input id="powExpr" placeholder="Ù…Ø«Ø§Ù„: 7^3 / 7^5">
          <div style="margin-top:8px"><button class="btn" onclick="doPower()">Ù†Ù…Ø§ÛŒØ´ Ù…Ø±Ø§Ø­Ù„</button></div>
          <div id="powOut" style="margin-top:10px"></div>
        </div>
        <div class="col">
          <label>Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±ÛŒØ´Ù‡/ØªÙˆØ§Ù† â€” ÙˆØ±ÙˆØ¯ÛŒ Ù‚Ø§Ø¨Ù„ Ù‚Ø¨ÙˆÙ„: <span class="kbd">root(9)</span> ÛŒØ§ <span class="kbd">2^3</span></label>
          <input id="evalExpr" placeholder="Ù…Ø«Ø§Ù„: root(16) + 2^3">
          <div style="margin-top:8px"><button class="btn" onclick="evalExpr()">Ù…Ø­Ø§Ø³Ø¨Ù‡</button></div>
          <div id="evalOut" style="margin-top:10px"></div>
        </div>
      </div>
    </div>
  </div>

  <div id="ch5" class="content hidden">
    <div class="lesson">
      <h2>ğŸ“˜ ÙØµÙ„ Ûµ â€” Ø¹Ø¨Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¨Ø±ÛŒ (Ù…Ø­Ø§Ø³Ø¨Ù‡)</h2>
      <label>Ø³Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¹Ø¨Ø§Ø±Øª Ø¬Ø¨Ø±ÛŒ (Ù…Ø«Ø§Ù„: (a+b)^2 ÛŒØ§ 2*x + 3*x )</label>
      <input id="algExpr" placeholder="Ù…Ø«Ø§Ù„: (x+2)^2 ÛŒØ§ 2*x + 3*x">
      <div style="margin-top:8px"><button class="btn" onclick="doAlgebra()">Ø³Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ / Ú¯Ø³ØªØ±Ø´</button></div>
      <div id="algOut" style="margin-top:10px"></div>
    </div>
  </div>

  <div id="ch6" class="content hidden">
    <div class="lesson">
      <h2>ğŸ“˜ ÙØµÙ„ Û¶ â€” Ø®Ø· Ùˆ Ù…Ø¹Ø§Ø¯Ù„Ù‡ Ø®Ø· (Ø¬Ø²ÙˆÙ‡)</h2>
      <p>Ù…Ø¹Ø§Ø¯Ù„Ù‡Ù” Ø®Ø· Ø¯Ø± ØµÙØ­Ù‡: y = m x + b</p>
      <div class="figure">
        <strong>Ø´ÛŒØ¨ m</strong> = (y2 - y1) / (x2 - x1)
        <div class="example">Ø§Ø² Ø¯Ùˆ Ù†Ù‚Ø·Ù‡ (1,2) Ùˆ (3,6): m = (6-2)/(3-1)=2 â†’ y=2x + b</div>
      </div>
      <div class="figure" style="margin-top:10px">
        <svg width="320" height="160"><line x1="20" y1="140" x2="300" y2="140" stroke="#aaa"/><line x1="20" y1="20" x2="20" y2="140" stroke="#aaa"/><polyline points="20,120 100,60 200,30" fill="none" stroke="#1565c0" stroke-width="2"/></svg>
      </div>
    </div>
  </div>

  <div id="ch7" class="content hidden">
    <div class="lesson">
      <h2>ğŸ“˜ÙØµÙ„ Û· â€” Ø¹Ø¨Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ú¯ÙˆÛŒØ§ (Ù…Ø­Ø§Ø³Ø¨Ù‡)</h2>
      <label>ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ Ø¹Ø¨Ø§Ø±Øª Ú¯ÙˆÛŒØ§ (Ù…Ø«Ø§Ù„: (2/x) + (3/x) )</label>
      <input id="rationalExpr" placeholder="Ù…Ø«Ø§Ù„: 2/x + 3/x">
      <div style="margin-top:8px"><button class="btn" onclick="doRational()">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ Ø³Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ</button></div>
      <div id="ratOut" style="margin-top:10px"></div>
    </div>
  </div>

  <div id="ch8" class="content hidden">
    <div class="lesson">
      <h2>ğŸ“˜ ÙØµÙ„ Û¸ â€” Ø­Ø¬Ù… Ùˆ Ù…Ø³Ø§Ø­Øª (Ù…Ø­Ø§Ø³Ø¨Ù‡)</h2>
      <div class="row">
        <div class="col">
          <label>Ø­Ø¬Ù… Ø§Ø³ØªÙˆØ§Ù†Ù‡: V = Ï€ rÂ² h</label>
          <input id="cylR" placeholder="Ø´Ø¹Ø§Ø¹ r">
          <input id="cylH" placeholder="Ø§Ø±ØªÙØ§Ø¹ h">
          <div style="margin-top:8px"><button class="btn" onclick="volCylinder()">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø­Ø¬Ù…</button></div>
          <div id="volOut" style="margin-top:10px"></div>
        </div>
        <div class="col">
          <label>Ù…Ø³Ø§Ø­Øª Ù…Ø³ØªØ·ÛŒÙ„: A = a Ã— b</label>
          <input id="rectA" placeholder="a">
          <input id="rectB" placeholder="b">
          <div style="margin-top:8px"><button class="btn" onclick="areaRect()">Ù…Ø­Ø§Ø³Ø¨Ù‡</button></div>
          <div id="areaOut" style="margin-top:10px"></div>
        </div>
      </div>
      <hr>
      <div>
        <label>Ø§Ø­ØªÙ…Ø§Ù„ Ùˆ Ø¢Ù…Ø§Ø± (ÙØµÙ„ Û¹ Ø¯Ø± Ø§ÛŒÙ† ÙØ§ÛŒÙ„: Ø¢Ù…Ø§Ø± Ùˆ Ø§Ø­ØªÙ…Ø§Ù„)</label>
        <div class="row">
          <div class="col">
            <button class="btn" onclick="probPrompt()">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ø­ØªÙ…Ø§Ù„ (Ø³Ø§Ø¯Ù‡)</button>
          </div>
          <div class="col">
            <button class="btn" onclick="percentPrompt()">Ø¯Ø±ØµØ¯ / ÙØ±Ø§ÙˆØ§Ù†ÛŒ Ù†Ø³Ø¨ÛŒ</button>
          </div>
        </div>
        <div id="statOut" style="margin-top:10px"></div>
      </div>
    </div>
  </div>

  <footer>Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡: Ù…Ø­Ù…Ø¯Ø­Ø³ÛŒÙ† ØµØ§Ø¯Ù‚ÛŒ</footer>
</div>

<script>
/* helper show */
function show(id){
  document.querySelectorAll('.content').forEach(el=>el.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
  window.scrollTo({top:0,behavior:'smooth'});
}

/* ---------- Chapter 1: sets ---------- */
function parseSet(s){ return s.trim()===''? new Set(): new Set(s.trim().split(/\s+/)); }
function setToArray(st){ return Array.from(st).sort((a,b)=>Number(a)-Number(b)); }
function doSet(){
  const A = parseSet(document.getElementById('setA').value);
  const B = parseSet(document.getElementById('setB').value);
  const op = document.getElementById('setOp').value;
  let out;
  if(op==='union'){ out = new Set([...A, ...B]); }
  else if(op==='inter'){ out = new Set([...A].filter(x=>B.has(x))); }
  else { out = new Set([...A].filter(x=>!B.has(x))); }
  document.getElementById('setOut').innerText = 'Ù†ØªÛŒØ¬Ù‡: {' + setToArray(out).join(', ') + '}';
}
function doSubsets(){ const n = Number(document.getElementById('subN').value); if(isNaN(n)) return; document.getElementById('subOut').innerText = `ØªØ¹Ø¯Ø§Ø¯ Ø²ÛŒØ±Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§ = 2^${n} = ${2**n}`; }
function doInclusion(){
  const A = Number(document.getElementById('incA').value);
  const B = Number(document.getElementById('incB').value);
  const both = Number(document.getElementById('incBoth').value);
  if(isNaN(A)||isNaN(B)||isNaN(both)) return;
  document.getElementById('incOut').innerText = `Ú©Ù„ Ø§Ø¹Ø¶Ø§ = ${A + B - both}`;
}

/* ---------- Chapter 2: absolute (special handling) ---------- */
/* normalize user expression: root(...), v(...), ^ powers allowed, '/' allowed */
function normalizeInput(expr){
  if(!expr) return '';
  expr = expr.replace(/âˆš/g,'root(').replace(/v\(/g,'root('); // rare
  // replace root(x) occurrences keep
  // math.js supports sqrt(x) and ^. We'll normalize root(...) -> sqrt(...)
  expr = expr.replace(/root\s*\(/g,'sqrt(');
  // allow ^ as power (mathjs supports ^)
  return expr;
}

/* evaluate expression safely with math.js and return numeric value or throw */
function evalExprValue(expr){
  const normalized = normalizeInput(expr);
  // use math.evaluate with number result
  return math.evaluate(normalized);
}

/* show step-by-step absolute handling */
function absCompute(raw){
  // raw may be something like "|...|" or without bars
  let inner = raw.trim();
  if(inner.startsWith('|') && inner.endsWith('|')) inner = inner.slice(1,-1).trim();
  inner = normalizeInput(inner);
  let steps = [];
  steps.push(`Ø¹Ø¨Ø§Ø±Øª Ø¯Ø§Ø®Ù„ Ù‚Ø¯Ø± Ù…Ø·Ù„Ù‚: ${inner}`);
  // Try to evaluate numerically
  try{
    const numeric = math.evaluate(inner);
    steps.push(`Ù…Ù‚Ø¯Ø§Ø± Ø¹Ø¯Ø¯ÛŒ Ø¹Ø¨Ø§Ø±Øª = ${numeric}`);
    const absv = Math.abs(numeric);
    steps.push(`Ù‚Ø¯Ø± Ù…Ø·Ù„Ù‚ = |${numeric}| = ${absv}`);
    return {steps, result:absv};
  }catch(e){
    // If not fully numeric, try to simplify symbolic with math.simplify
    try{
      const simplified = math.simplify(inner).toString();
      steps.push(`Ø³Ø§Ø¯Ù‡â€ŒØ´Ø¯Ù‡: ${simplified}`);
      // try numeric of simplified
      const num = math.evaluate(simplified);
      steps.push(`Ù…Ù‚Ø¯Ø§Ø± Ø¹Ø¯Ø¯ÛŒ Ø³Ø§Ø¯Ù‡â€ŒØ´Ø¯Ù‡ = ${num}`);
      const absv = Math.abs(num);
      steps.push(`Ù‚Ø¯Ø± Ù…Ø·Ù„Ù‚ = |${num}| = ${absv}`);
      return {steps,result:absv};
    }catch(err){
      // fallback: show simplified symbolic absolute form
      steps.push('Ù†Ø´Ø¯ Ù…Ù‚Ø¯Ø§Ø± Ø¹Ø¯Ø¯ÛŒ Ø¯Ù‚ÛŒÙ‚ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´ÙˆØ¯Ø› Ù‚Ø¯Ø± Ù…Ø·Ù„Ù‚ Ù†Ù…Ø§Ø¯ÛŒÙ† Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.');
      return {steps,result:`|${inner}|`};
    }
  }
}

/* UI handler */
function calculateAbs(){
  const raw = document.getElementById('absInput').value;
  if(!raw){ document.getElementById('absResult').innerText='Ù„Ø·ÙØ§Ù‹ Ø¹Ø¨Ø§Ø±Øª ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯'; return; }
  const out = absCompute(raw);
  document.getElementById('absResult').innerHTML = '<div class="steps">' + out.steps.map(s=>'â€¢ '+s).join('<br>') + '</div><div style="margin-top:8px">Ù†ØªÛŒØ¬Ù‡: <strong>' + out.result + '</strong></div>';
}

/* ---------- Chapter 4: power/root ---------- */
function doPower(){
  const expr = document.getElementById('powExpr').value.trim();
  if(!expr){ document.getElementById('powOut').innerText='ÙˆØ±ÙˆØ¯ÛŒ Ù„Ø§Ø²Ù… Ø§Ø³Øª'; return; }
  // try to parse a^m / a^n
  // remove spaces
  const e = expr.replace(/\s+/g,'');
  const m = e.match(/^(.+)\^([-\d]+)\/(.+)\^([-\d]+)$/);
  if(m && m[1]===m[3]){
    const base = m[1], a = Number(m[2]), b = Number(m[4]);
    const step1 = `${base}^${a} Ã· ${base}^${b} = ${base}^(${a}-${b})`;
    const step2 = `${base}^${a-b}`;
    document.getElementById('powOut').innerHTML = `<div class="steps">â€¢ ${step1}<br>â€¢ Ù†ØªÛŒØ¬Ù‡: ${step2}</div>`;
    return;
  }
  document.getElementById('powOut').innerText = 'Ù‚Ø§Ø¨Ù„ÛŒØª: a^m / a^n Ø±Ø§ ØªØ­Ù„ÛŒÙ„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯. (Ù…Ø«Ø§Ù„: 7^3 / 7^5)';
}

function evalExpr(){
  const raw = document.getElementById('evalExpr').value.trim();
  if(!raw){ document.getElementById('evalOut').innerText='ÙˆØ±ÙˆØ¯ÛŒ Ù„Ø§Ø²Ù… Ø§Ø³Øª'; return; }
  const norm = normalizeInput(raw);
  try{
    const val = math.evaluate(norm);
    document.getElementById('evalOut').innerHTML = `Ù†ØªÛŒØ¬Ù‡: ${val}`;
  }catch(e){
    document.getElementById('evalOut').innerText = 'Ø®Ø·Ø§ Ø¯Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡ ÛŒØ§ ÙØ±Ù…Øª ÙˆØ±ÙˆØ¯ÛŒ';
  }
}

/* ---------- Chapter 5: algebra ---------- */
function doAlgebra(){
  const raw = document.getElementById('algExpr').value.trim();
  if(!raw){ document.getElementById('algOut').innerText='ÙˆØ±ÙˆØ¯ÛŒ Ù„Ø§Ø²Ù… Ø§Ø³Øª'; return; }
  try{
    const simplified = math.simplify(raw).toString();
    const expanded = math.expand ? math.expand(raw).toString() : simplified;
    document.getElementById('algOut').innerHTML = `<div>Ø³Ø§Ø¯Ù‡â€ŒØ´Ø¯Ù‡: ${simplified}</div><div>Ú¯Ø³ØªØ±Ø´: ${expanded}</div>`;
  }catch(e){
    document.getElementById('algOut').innerText='Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¹Ø¨Ø§Ø±Øª Ø¬Ø¨Ø±ÛŒ';
  }
}

/* ---------- Chapter 7: rational ---------- */
function doRational(){
  const raw = document.getElementById('rationalExpr').value.trim();
  if(!raw){ document.getElementById('ratOut').innerText='ÙˆØ±ÙˆØ¯ÛŒ Ù„Ø§Ø²Ù… Ø§Ø³Øª'; return; }
  try{
    const simp = math.simplify(raw).toString();
    document.getElementById('ratOut').innerHTML = `Ø³Ø§Ø¯Ù‡â€ŒØ´Ø¯Ù‡: ${simp}`;
  }catch(e){
    document.getElementById('ratOut').innerText='Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¹Ø¨Ø§Ø±Øª Ú¯ÙˆÛŒØ§';
  }
}

/* ---------- Chapter 8: volumes/areas & stats ---------- */
function volCylinder(){
  const r = Number(document.getElementById('cylR').value);
  const h = Number(document.getElementById('cylH').value);
  if(isNaN(r)||isNaN(h)){ document.getElementById('volOut').innerText='ÙˆØ±ÙˆØ¯ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø±'; return; }
  const v = Math.PI * r * r * h;
  document.getElementById('volOut').innerText = `V = Ï€ Ã—${r}Â² Ã— ${h} = ${v.toFixed(4)}`;
}
function areaRect(){
  const a = Number(document.getElementById('rectA').value);
  const b = Number(document.getElementById('rectB').value);
  if(isNaN(a)||isNaN(b)){ document.getElementById('areaOut').innerText='ÙˆØ±ÙˆØ¯ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø±'; return; }
  document.getElementById('areaOut').innerText = `A = ${a} Ã— ${b} = ${ (a*b).toFixed(4) }`;
}

function probPrompt(){
  const fav = prompt("ØªØ¹Ø¯Ø§Ø¯ Ø­Ø§Ù„Ø§Øª Ù…Ø·Ù„ÙˆØ¨ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†:");
  const total = prompt("ØªØ¹Ø¯Ø§Ø¯ Ø­Ø§Ù„Ø§Øª Ù…Ù…Ú©Ù† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†:");
  if(!fav||!total) return;
  const p = Number(fav)/Number(total);
  document.getElementById('statOut').innerText = `Ø§Ø­ØªÙ…Ø§Ù„ = ${p} = ${fav}/${total}`;
}
function percentPrompt(){
  const part = prompt("ØªØ¹Ø¯Ø§Ø¯ Ù…ÙˆØ±Ø¯Ù†Ø¸Ø±:");
  const whole = prompt("ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„:");
  if(!part||!whole) return;
  document.getElementById('statOut').innerText = `Ø¯Ø±ØµØ¯ = ${ (Number(part)/Number(whole)*100).toFixed(2) }%`;
}

/* ---------- utility on load ---------- */
document.addEventListener('DOMContentLoaded',()=>{ show('ch1'); });

</script>
</body>
</html>